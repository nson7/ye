
" -----------------------------------------------------------------------------
"  < åˆ¤æ–­æ“ä½œç³»ç»Ÿæ˜¯å¦æ˜¯ Windows è¿˜æ˜¯ Linux >
" -----------------------------------------------------------------------------
let g:iswindows = 0
let g:islinux = 0
if(has("win32") || has("win64") || has("win95") || has("win16"))
    let g:iswindows = 1
else
    let g:islinux = 1
endif

" -----------------------------------------------------------------------------
"  < åˆ¤æ–­æ˜¯ç»ˆç«¯è¿˜æ˜¯ Gvim >
" -----------------------------------------------------------------------------
" if has("gui_running")
    " let g:isGUI = 1
" else
    " let g:isGUI = 0
" endif

" ä¿®æ”¹leaderé”®
let mapleader = ','
let g:mapleader = ','

" å¼€å¯è¯­æ³•é«˜äº®
syntax on

" install bundles
if filereadable(expand("~/.vimrc.bundles"))
  source ~/.vimrc.bundles
endif

" ensure ftdetect et al work by including this after the bundle stuff
filetype plugin indent on

"==========================================
" General Settings åŸºç¡€è®¾ç½®
"==========================================

" historyå­˜å‚¨å®¹é‡
set history=70

" æ£€æµ‹æ–‡ä»¶ç±»å‹
filetype on
" é’ˆå¯¹ä¸åŒçš„æ–‡ä»¶ç±»å‹é‡‡ç”¨ä¸åŒçš„ç¼©è¿›æ ¼å¼
filetype indent on
" å…è®¸æ’ä»¶
filetype plugin on
" å¯åŠ¨è‡ªåŠ¨è¡¥å…¨
filetype plugin indent on

" æ–‡ä»¶ä¿®æ”¹ä¹‹åè‡ªåŠ¨è½½å…¥
set autoread
" å¯åŠ¨çš„æ—¶å€™ä¸æ˜¾ç¤ºé‚£ä¸ªæ´åŠ©ä¹Œå¹²è¾¾å„¿ç«¥çš„æç¤º
set shortmess=atI

" å¤‡ä»½,åˆ°å¦ä¸€ä¸ªä½ç½®. é˜²æ­¢è¯¯åˆ , ç›®å‰æ˜¯å–æ¶ˆå¤‡ä»½
"set backup
"set backupext=.bak
"set backupdir=/tmp/vimbk/

" å–æ¶ˆå¤‡ä»½ã€‚ è§†æƒ…å†µè‡ªå·±æ”¹
set nobackup
" å…³é—­äº¤æ¢æ–‡ä»¶
set noswapfile

set wildignore=*.swp,*.bak,*.pyc,*.class,.svn

" ç¦»å¼€æ’å…¥æ¨¡å¼åè‡ªåŠ¨å…³é—­é¢„è§ˆçª—å£
autocmd InsertLeave * if pumvisible() == 0|pclose|endif

" å›è½¦å³é€‰ä¸­å½“å‰é¡¹
inoremap <expr> <CR>       pumvisible() ? "\<C-y>" : "\<CR>"

" In the quickfix window, <CR> is used to jump to the error under the
" cursor, so undefine the mapping there.
autocmd BufReadPost quickfix nnoremap <buffer> <CR> <CR>
" quickfix window  s/v to open in split window,  ,gd/,jd => quickfix window => open it
autocmd BufReadPost quickfix nnoremap <buffer> v <C-w><Enter><C-w>L
autocmd BufReadPost quickfix nnoremap <buffer> s <C-w><Enter><C-w>K

" command-line window
autocmd CmdwinEnter * nnoremap <buffer> <CR> <CR>

" çªå‡ºæ˜¾ç¤ºå½“å‰åˆ—
set cursorcolumn
" çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œ
set cursorline

" è®¾ç½® é€€å‡ºvimåï¼Œå†…å®¹æ˜¾ç¤ºåœ¨ç»ˆç«¯å±å¹•, å¯ä»¥ç”¨äºæŸ¥çœ‹å’Œå¤åˆ¶, ä¸éœ€è¦å¯ä»¥å»æ‰
" å¥½å¤„ï¼šè¯¯åˆ ä»€ä¹ˆçš„ï¼Œå¦‚æœä»¥å‰å±å¹•æ‰“å¼€ï¼Œå¯ä»¥æ‰¾å›
set t_ti= t_te=

" é¼ æ ‡æš‚ä¸å¯ç”¨, é”®ç›˜å…š....
"set mouse-=a
" å¯ç”¨é¼ æ ‡
" set mouse=a
" Hide the mouse cursor while typing
" set mousehide


" ä¿®å¤ctrl+m å¤šå…‰æ ‡æ“ä½œé€‰æ‹©çš„bugï¼Œä½†æ˜¯æ”¹å˜äº†ctrl+vè¿›è¡Œå­—ç¬¦é€‰ä¸­æ—¶å°†åŒ…å«å…‰æ ‡ä¸‹çš„å­—ç¬¦
"set selection=inclusive
"set selectmode=mouse,key

" change the terminal's title
set title
" å»æ‰è¾“å…¥é”™è¯¯çš„æç¤ºå£°éŸ³
set novisualbell
set noerrorbells
set t_vb=
set tm=500

" Remember info about open buffers on close
"set viminfo^=%

" For regular expressions turn magic on
set magic

" Configure backspace so it acts as it should act
"set backspace=eol,start,indent
"set whichwrap+=<,>,h,l

"==========================================
" Display Settings å±•ç¤º/æ’ç‰ˆç­‰ç•Œé¢æ ¼å¼è®¾ç½®
"==========================================

" æ˜¾ç¤ºå½“å‰çš„è¡Œå·åˆ—å·
set ruler
" åœ¨çŠ¶æ€æ æ˜¾ç¤ºæ­£åœ¨è¾“å…¥çš„å‘½ä»¤
set showcmd
" å·¦ä¸‹è§’æ˜¾ç¤ºå½“å‰vimæ¨¡å¼
set showmode

" åœ¨ä¸Šä¸‹ç§»åŠ¨å…‰æ ‡æ—¶ï¼Œå…‰æ ‡çš„ä¸Šæ–¹æˆ–ä¸‹æ–¹è‡³å°‘ä¼šä¿ç•™æ˜¾ç¤ºçš„è¡Œæ•°
set scrolloff=7

" set winwidth=79

" å‘½ä»¤è¡Œï¼ˆåœ¨çŠ¶æ€è¡Œä¸‹ï¼‰çš„é«˜åº¦ï¼Œé»˜è®¤ä¸º1ï¼Œè¿™é‡Œæ˜¯2
set statusline=%<%f\ %h%m%r%=%k[%{(&fenc==\"\")?&enc:&fenc}%{(&bomb?\",BOM\":\"\")}]\ %-14.(%l,%c%V%)\ %P
" Always show the status line - use 2 lines for the status bar
set laststatus=2

" æ˜¾ç¤ºè¡Œå·
set number
" å–æ¶ˆæ¢è¡Œ
set nowrap

" æ‹¬å·é…å¯¹æƒ…å†µ, è·³è½¬å¹¶é«˜äº®ä¸€ä¸‹åŒ¹é…çš„æ‹¬å·
set showmatch
" How many tenths of a second to blink when matching brackets
set matchtime=2


" è®¾ç½®æ–‡å†…æ™ºèƒ½æœç´¢æç¤º
" é«˜äº®searchå‘½ä¸­çš„æ–‡æœ¬
set hlsearch
" æ‰“å¼€å¢é‡æœç´¢æ¨¡å¼,éšç€é”®å…¥å³æ—¶æœç´¢
set incsearch
" æœç´¢æ—¶å¿½ç•¥å¤§å°å†™
set ignorecase
" æœ‰ä¸€ä¸ªæˆ–ä»¥ä¸Šå¤§å†™å­—æ¯æ—¶ä»å¤§å°å†™æ•æ„Ÿ
set smartcase

" ä»£ç æŠ˜å 
"set foldenable
" æŠ˜å æ–¹æ³•
" manual    æ‰‹å·¥æŠ˜å 
" indent    ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºæŠ˜å 
" expr      ä½¿ç”¨è¡¨è¾¾å¼å®šä¹‰æŠ˜å 
" syntax    ä½¿ç”¨è¯­æ³•å®šä¹‰æŠ˜å 
" diff      å¯¹æ²¡æœ‰æ›´æ”¹çš„æ–‡æœ¬è¿›è¡ŒæŠ˜å 
" marker    ä½¿ç”¨æ ‡è®°è¿›è¡ŒæŠ˜å , é»˜è®¤æ ‡è®°æ˜¯ {{{ å’Œ }}}
set foldmethod=indent
set foldlevel=99
let g:FoldMethod = 0
nnoremap <leader>zi :call ToggleFold()<cr>
fun! ToggleFold()
    if g:FoldMethod == 0
        exe "normal! zM"
        let g:FoldMethod = 1
    else
        exe "normal! zR"
        let g:FoldMethod = 0
    endif
endfun

" function scroll
let g:TguiMode = 0
nnoremap <leader>tt :call Tgui()<cr>
fun! Tgui()
    if g:TguiMode == 0
        set guioptions=r
        let g:TguiMode = 1
    else
        set guioptions-=r
        let g:TguiMode = 0
    endif
endfun

" http://stackoverflow.com/questions/13194428/is-better-way-to-zoom-windows-in-vim-than-zoomwin
" Zoom / Restore window.
function! s:ZoomToggle() abort
    if exists('t:zoomed') && t:zoomed
        execute t:zoom_winrestcmd
        let t:zoomed = 0
    else
        let t:zoom_winrestcmd = winrestcmd()
        resize
        vertical resize
        let t:zoomed = 1
    endif
endfunction
command! ZoomToggle call s:ZoomToggle()
nnoremap <silent> <Leader>zz :ZoomToggle<CR>

set gcr=a:blinkon0

" ç¼©è¿›é…ç½®
" Smart indent
set smartindent
" æ‰“å¼€è‡ªåŠ¨ç¼©è¿›
" never add copyindent, case error   " copy the previous indentation on autoindenting
set autoindent

" tabç›¸å…³å˜æ›´
" è®¾ç½®Tabé”®çš„å®½åº¦        [ç­‰åŒçš„ç©ºæ ¼ä¸ªæ•°]
set tabstop=4
" æ¯ä¸€æ¬¡ç¼©è¿›å¯¹åº”çš„ç©ºæ ¼æ•°
set shiftwidth=4
" æŒ‰é€€æ ¼é”®æ—¶å¯ä»¥ä¸€æ¬¡åˆ æ‰ 4 ä¸ªç©ºæ ¼
set softtabstop=4
" insert tabs on the start of a line according to shiftwidth, not tabstop æŒ‰é€€æ ¼é”®æ—¶å¯ä»¥ä¸€æ¬¡åˆ æ‰ 4 ä¸ªç©ºæ ¼
set smarttab
" å°†Tabè‡ªåŠ¨è½¬åŒ–æˆç©ºæ ¼[éœ€è¦è¾“å…¥çœŸæ­£çš„Tabé”®æ—¶ï¼Œä½¿ç”¨ Ctrl+V + Tab]
set expandtab
" ç¼©è¿›æ—¶ï¼Œå–æ•´ use multiple of shiftwidth when indenting with '<' and '>'
set shiftround

" A buffer becomes hidden when it is abandoned
set hidden
set wildmode=list:longest
set ttyfast

" 00xå¢å‡æ•°å­—æ—¶ä½¿ç”¨åè¿›åˆ¶
set nrformats=

" ç›¸å¯¹è¡Œå·: è¡Œå·å˜æˆç›¸å¯¹ï¼Œå¯ä»¥ç”¨ nj/nk è¿›è¡Œè·³è½¬
set relativenumber number
au FocusLost * :set norelativenumber number
au FocusGained * :set relativenumber
" æ’å…¥æ¨¡å¼ä¸‹ç”¨ç»å¯¹è¡Œå·, æ™®é€šæ¨¡å¼ä¸‹ç”¨ç›¸å¯¹
autocmd InsertEnter * :set norelativenumber number
autocmd InsertLeave * :set relativenumber
function! NumberToggle()
  if(&relativenumber == 1)
    set norelativenumber number
  else
    set relativenumber
  endif
endfunc
nnoremap <leader>nu :call NumberToggle()<cr>

"==========================================
" FileEncode Settings æ–‡ä»¶ç¼–ç ,æ ¼å¼
"==========================================
" è®¾ç½®æ–°æ–‡ä»¶çš„ç¼–ç ä¸º UTF-8
set encoding=utf-8
" è‡ªåŠ¨åˆ¤æ–­ç¼–ç æ—¶ï¼Œä¾æ¬¡å°è¯•ä»¥ä¸‹ç¼–ç ï¼š
set fileencodings=utf-8,ucs-bom,cp936,gb18030,big5,euc-jp,euc-kr,latin1
set helplang=cn
"setÂ langmenu=zh_CN.UTF-8
"set enc=2byte-gb18030
" ä¸‹é¢è¿™å¥åªå½±å“æ™®é€šæ¨¡å¼ (éå›¾å½¢ç•Œé¢) ä¸‹çš„ Vim
set termencoding=utf-8

" Use Unix as the standard file type
set ffs=unix,dos,mac

" å¦‚é‡Unicodeå€¼å¤§äº255çš„æ–‡æœ¬ï¼Œä¸å¿…ç­‰åˆ°ç©ºæ ¼å†æŠ˜è¡Œ
set formatoptions+=m
" åˆå¹¶ä¸¤è¡Œä¸­æ–‡æ—¶ï¼Œä¸åœ¨ä¸­é—´åŠ ç©ºæ ¼
set formatoptions+=B

"==========================================
" others å…¶å®ƒè®¾ç½®
"==========================================
" vimrcæ–‡ä»¶ä¿®æ”¹ä¹‹åè‡ªåŠ¨åŠ è½½, windows
autocmd! bufwritepost _vimrc source %
" vimrcæ–‡ä»¶ä¿®æ”¹ä¹‹åè‡ªåŠ¨åŠ è½½, linux
autocmd! bufwritepost .vimrc source %

" è‡ªåŠ¨è¡¥å…¨é…ç½®
" è®©Vimçš„è¡¥å…¨èœå•è¡Œä¸ºä¸ä¸€èˆ¬IDEä¸€è‡´(å‚è€ƒVimTip1228)
set completeopt=longest,menu

" å¢å¼ºæ¨¡å¼ä¸­çš„å‘½ä»¤è¡Œè‡ªåŠ¨å®Œæˆæ“ä½œ
set wildmenu
" Ignore compiled files
set wildignore=*.o,*~,*.pyc,*.class

" ç¦»å¼€æ’å…¥æ¨¡å¼åè‡ªåŠ¨å…³é—­é¢„è§ˆçª—å£
autocmd InsertLeave * if pumvisible() == 0|pclose|endif

" æ‰“å¼€è‡ªåŠ¨å®šä½åˆ°æœ€åç¼–è¾‘çš„ä½ç½®, éœ€è¦ç¡®è®¤ .viminfo å½“å‰ç”¨æˆ·å¯å†™
if has("autocmd")
  au BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$") | exe "normal! g'\"" | endif
endif

"==========================================
" HotKey Settings  è‡ªå®šä¹‰å¿«æ·é”®è®¾ç½®
"==========================================

"Treat long lines as break lines (useful when moving around in them)
"se swapä¹‹åï¼ŒåŒç‰©ç†è¡Œä¸Šçº¿ç›´æ¥è·³
nnoremap k gk
nnoremap gk k
nnoremap j gj
nnoremap gj j
nnoremap <leader>bb :b#<cr>
nnoremap <leader>mm :only<cr>
nnoremap ;; q:k<CR>

inoremap ( ()<ESC>i
inoremap [ []<ESC>i
inoremap { {}<ESC>i

" å…³é—­æ–¹å‘é”®, å¼ºè¿«è‡ªå·±ç”¨ hjkl
" map <Left> <Nop>
" map <Right> <Nop>
" map <Up> <Nop>
" map <Down> <Nop>

" åˆ†å±çª—å£ç§»åŠ¨, Smart way to move between windows
map <C-j> <C-W>j
map <C-k> <C-W>k
map <C-h> <C-W>h
map <C-l> <C-W>l
map <C-r> <C-W>r

if has("cscope")
    set csprg=/usr/bin/cscope
    set csto=0
    set cst
    set nocsverb
    " add any database in current directory
    if filereadable("cscope.out")
        cs add cscope.out
    " else add database pointed to by environment
    elseif $CSCOPE_DB != ""
        cs add $CSCOPE_DB
    endif
    set csverb
endif

" sï¼šæŸ¥æ‰¾Cä»£ç ç¬¦å·
" gï¼šæŸ¥æ‰¾æœ¬å®šä¹‰
" cï¼šæŸ¥æ‰¾è°ƒç”¨æœ¬å‡½æ•°çš„å‡½æ•°
" tï¼šæŸ¥æ‰¾æœ¬å­—ç¬¦ä¸²
" eï¼šæŸ¥æ‰¾æœ¬egrepæ¨¡å¼
" fï¼šæŸ¥æ‰¾æœ¬æ–‡ä»¶
" iï¼šæŸ¥æ‰¾åŒ…å«æœ¬æ–‡ä»¶çš„æ–‡ä»¶
" dï¼šæŸ¥æ‰¾æœ¬å‡½æ•°è°ƒç”¨çš„å‡½æ•°
nnoremap <Leader>ss :cs find s <C-R>=expand("<cword>")<CR><CR>
nnoremap <Leader>ww :cs find g <C-R>=expand("<cword>")<CR><CR>
" nnoremap <Leader>uu :cs find c <C-R>=expand("<cword>")<CR><CR>
" nnoremap <Leader>xx :cs find t <C-R>=expand("<cword>")<CR><CR>
" nnoremap <Leader>ee :cs find e <C-R>=expand("<cword>")<CR><CR>
" nnoremap <Leader>uu :cs find f <C-R>=expand("<cfile>")<CR><CR>
" nnoremap <Leader>aa :cs find i ^<C-R>=expand("<cfile>")<CR>$<CR>
" nnoremap <Leader>dd :cs find d <C-R>=expand("<cword>")<CR><CR>

" Go to home and end using capitalized directions
nnoremap H ^
nnoremap L $

" æœç´¢ç›¸å…³
nnoremap <space> :nohls<CR>

" Keep search pattern at the center of the screen.
nnoremap <silent> n nzz
nnoremap <silent> N Nzz
nnoremap <silent> * *zz
nnoremap <silent> # #zz
nnoremap <silent> g* g*zz

" for # indent, pythonæ–‡ä»¶ä¸­è¾“å…¥æ–°è¡Œæ—¶#å·æ³¨é‡Šä¸åˆ‡å›è¡Œé¦–
autocmd BufNewFile,BufRead *.py inoremap # X<c-h>#

" normalæ¨¡å¼ä¸‹åˆ‡æ¢åˆ°ç¡®åˆ‡çš„tab
nnoremap <leader>1 1gt
nnoremap <leader>2 2gt
nnoremap <leader>3 3gt
nnoremap <leader>4 4gt
nnoremap <leader>5 5gt
nnoremap <leader>6 6gt
nnoremap <leader>7 7gt
nnoremap <leader>8 8gt
nnoremap <leader>9 9gt
nnoremap <leader>0 :tablast<cr>

" y$ -> Y Make Y behave like other capitals
nnoremap Y y$

" å¤åˆ¶é€‰ä¸­åŒºåˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿ä¸­
vnoremap <leader>y "+y
" auto jump to end of select
" vnoremap <silent> y y`]
" vnoremap <silent> p p`]
" nnoremap <silent> p p`]

" select all
" nnoremap <Leader>sa ggVG

" select block
" nnoremap <leader>v V`}

" kj æ›¿æ¢ Esc
inoremap kj <Esc>
vnoremap kj <Esc>

"remap U to <C-r> for easier redo
nnoremap U <C-r>

"==========================================
" FileType Settings  æ–‡ä»¶ç±»å‹è®¾ç½®
"==========================================

" å…·ä½“ç¼–è¾‘æ–‡ä»¶ç±»å‹çš„ä¸€èˆ¬è®¾ç½®ï¼Œæ¯”å¦‚ä¸è¦ tab ç­‰
autocmd FileType python set tabstop=4 shiftwidth=4 expandtab ai
autocmd FileType ruby,javascript,html,css,xml set tabstop=2 shiftwidth=2 softtabstop=2 expandtab ai
autocmd BufRead,BufNewFile *.md,*.mkd,*.markdown set filetype=markdown.mkd
autocmd BufRead,BufNewFile *.part set filetype=html
" disable showmatch when use > in php
au BufWinEnter *.php set mps-=<:>



" ä¿å­˜æ–‡ä»¶æ—¶åˆ é™¤å¤šä½™ç©ºæ ¼
fun! <SID>StripTrailingWhitespaces()
    let l = line(".")
    let c = col(".")
    %s/\s\+$//e
    call cursor(l, c)
endfun
autocmd FileType c,cpp,java,go,php,javascript,puppet,python,rust,twig,xml,yml,perl autocmd BufWritePre <buffer> :call <SID>StripTrailingWhitespaces()

"æ–°å»º.c,.h,.sh,.javaæ–‡ä»¶ï¼Œè‡ªåŠ¨æ’å…¥æ–‡ä»¶å¤´
autocmd BufNewFile *.cpp,*.[ch],*.sh,*.rb,*.java,*.py exec ":call SetTitle()"
""å®šä¹‰å‡½æ•°SetTitleï¼Œè‡ªåŠ¨æ’å…¥æ–‡ä»¶å¤´
function! SetTitle()
	"å¦‚æœæ–‡ä»¶ç±»å‹ä¸º.shæ–‡ä»¶
	if expand("%:e") == 'sh'
		call setline(1,"\#!/bin/bash")
		call append(line("."), "")
    elseif expand("%:e") == 'py'
        call setline(1,"#!/usr/bin/env python")
        call append(line("."),"# coding=utf-8")
	    call append(line(".")+1, "")

    elseif expand("%:e") == 'rb'
        call setline(1,"#!/usr/bin/env ruby")
        call append(line("."),"# encoding: utf-8")
	    call append(line(".")+1, "")

	else
		call setline(1, "/*************************************************************************")
		call append(line("."), "    > File Name: ".expand("%"))
		call append(line(".")+1, "	> Author: nson7")
		call append(line(".")+2, "	> Mail: nson7@sina.com")
		call append(line(".")+3, "	> Created Time: ".strftime("%c"))
		call append(line(".")+4, " ************************************************************************/")
		call append(line(".")+5, "")
	endif
	if expand("%:e") == 'cpp'
		call append(line(".")+6, "#include<iostream>")
		call append(line(".")+7, "using namespace std;")
		call append(line(".")+8, "")
	endif
	if expand("%:e") == 'c'
		call append(line(".")+6, "#include<stdio.h>")
		call append(line(".")+7, "")
	endif
	if expand("%:e") == 'h'
		call append(line(".")+6, "#ifndef _".toupper(expand("%:r"))."_H")
		call append(line(".")+7, "#define _".toupper(expand("%:r"))."_H")
		call append(line(".")+8, "#endif")
		call append(line(".")+9, "#endif")
		call append(line(".")+10,"")
	endif
	if expand("%:e") == 'java'
		call append(line(".")+6,"public class ".expand("%:r"))
		call append(line(".")+7,"")
	endif
	"æ–°å»ºæ–‡ä»¶åï¼Œè‡ªåŠ¨å®šä½åˆ°æ–‡ä»¶æœ«å°¾
endfunc
autocmd BufNewFile * normal G

" è®¾ç½®å¯ä»¥é«˜äº®çš„å…³é”®å­—
if has("autocmd")
  " Highlight TODO, FIXME, NOTE, etc.
  if v:version > 701
    autocmd Syntax * call matchadd('Todo',  '\W\zs\(TODO\|FIXME\|CHANGED\|DONE\|XXX\|BUG\|HACK\)')
    autocmd Syntax * call matchadd('Debug', '\W\zs\(NOTE\|INFO\|IDEA\|NOTICE\)')
  endif
endif

"==========================================
" TEMP è®¾ç½®, å°šæœªç¡®å®šè¦ä¸è¦
"==========================================

" tmux
" function! WrapForTmux(s)
"   if !exists('$TMUX')
"     return a:s
"   endif
"
"   let tmux_start = "\<Esc>Ptmux;"
"   let tmux_end = "\<Esc>\\"
"
"   return tmux_start . substitute(a:s, "\<Esc>", "\<Esc>\<Esc>", 'g') . tmux_end
" endfunction

" let &t_SI .= WrapForTmux("\<Esc>[?2004h")
" let &t_EI .= WrapForTmux("\<Esc>[?2004l")

" allows cursor change in tmux mode
" let &t_SI = "\<Esc>]50;CursorShape=1\x7"
" let &t_EI = "\<Esc>]50;CursorShape=0\x7"
" if exists('$TMUX')
    " let &t_SI = "\<Esc>Ptmux;\<Esc>\<Esc>]50;CursorShape=1\x7\<Esc>\\"
    " let &t_EI = "\<Esc>Ptmux;\<Esc>\<Esc>]50;CursorShape=0\x7\<Esc>\\"
" endif


"==========================================
" Theme Settings  ä¸»é¢˜è®¾ç½®
"==========================================

" Set extra options when running in GUI mode
if has("gui_running")
    set guifont=courier_new:h14
    if has("gui_gtk2")   "GTK2
        set guifont=courier\New\ 14,Arial\ 14
    endif
    set guioptions-=T
    set guioptions+=e
    set guioptions-=r
    set guioptions-=L
    set guitablabel=%M\ %t
    set showtabline=1
    set linespace=2
    set noimd
endif



" themeä¸»é¢˜
set background=dark
"set background=light
set t_Co=256

if has('gui_running')
    let g:solarized_termtrans=1
    let g:solarized_contrast="normal"
    let g:solarized_visibility="normal"
    let g:solarized_termcolors=256
    colorscheme solarized
    set mouse=a
else
    let g:molokai_original = 1
    let g:rehash256 = 1
    let g:molokai_termoclolors=256
    colorscheme molokai
    set mouse-=a
endif

" è®¾ç½®æ ‡è®°ä¸€åˆ—çš„èƒŒæ™¯é¢œè‰²å’Œæ•°å­—ä¸€è¡Œé¢œè‰²ä¸€è‡´
hi! link SignColumn   LineNr
hi! link ShowMarksHLl DiffAdd
hi! link ShowMarksHLu DiffChange

" for error highlightï¼Œé˜²æ­¢é”™è¯¯æ•´è¡Œæ ‡çº¢å¯¼è‡´çœ‹ä¸æ¸…
highlight clear SpellBad
highlight SpellBad term=standout ctermfg=1 term=underline cterm=underline
highlight clear SpellCap
highlight SpellCap term=underline cterm=underline
highlight clear SpellRare
highlight SpellRare term=underline cterm=underline
highlight clear SpellLocal
highlight SpellLocal term=underline cterm=underline

" ################### è‡ªåŠ¨è¡¥å…¨ ###################

" YouCompleteMe {{{
    "youcompleteme  é»˜è®¤tab  s-tab å’Œè‡ªåŠ¨è¡¥å…¨å†²çª
    "let g:ycm_key_list_select_completion=['<c-n>']
    let g:ycm_key_list_select_completion = ['<Down>']
    "let g:ycm_key_list_previous_completion=['<c-p>']
    let g:ycm_key_list_previous_completion = ['<Up>']
    let g:ycm_complete_in_comments = 1  "åœ¨æ³¨é‡Šè¾“å…¥ä¸­ä¹Ÿèƒ½è¡¥å…¨
    let g:ycm_complete_in_strings = 1   "åœ¨å­—ç¬¦ä¸²è¾“å…¥ä¸­ä¹Ÿèƒ½è¡¥å…¨
    let g:ycm_use_ultisnips_completer = 1 "æç¤ºUltiSnips
    let g:ycm_collect_identifiers_from_comments_and_strings = 1   "æ³¨é‡Šå’Œå­—ç¬¦ä¸²ä¸­çš„æ–‡å­—ä¹Ÿä¼šè¢«æ”¶å…¥è¡¥å…¨
    let g:ycm_collect_identifiers_from_tags_files = 1
    " å¼€å¯è¯­æ³•å…³é”®å­—è¡¥å…¨
    let g:ycm_seed_identifiers_with_syntax=1

    "let g:ycm_seed_identifiers_with_syntax=1   "è¯­è¨€å…³é”®å­—è¡¥å…¨, ä¸è¿‡pythonå…³é”®å­—éƒ½å¾ˆçŸ­ï¼Œæ‰€ä»¥ï¼Œéœ€è¦çš„è‡ªå·±æ‰“å¼€

    " è·³è½¬åˆ°å®šä¹‰å¤„, åˆ†å±æ‰“å¼€
    let g:ycm_goto_buffer_command = 'horizontal-split'
    " nnoremap <leader>jd :YcmCompleter GoToDefinition<CR>
    nnoremap <leader>jd :YcmCompleter GoToDefinitionElseDeclaration<CR>
    nnoremap <leader>gd :YcmCompleter GoToDeclaration<CR>

    " å¼•å…¥ï¼Œå¯ä»¥è¡¥å…¨ç³»ç»Ÿï¼Œä»¥åŠpythonçš„ç¬¬ä¸‰æ–¹åŒ… é’ˆå¯¹æ–°è€ç‰ˆæœ¬YCMåšäº†å…¼å®¹
    " old version
    if !empty(glob("~/.vim/bundle/YouCompleteMe/cpp/ycm/.ycm_extra_conf.py"))
        let g:ycm_global_ycm_extra_conf = "~/.vim/bundle/YouCompleteMe/cpp/ycm/.ycm_extra_conf.py"
    endif
    " new version
    if !empty(glob("~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/ycm/.ycm_extra_conf.py"))
        let g:ycm_global_ycm_extra_conf = "~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/ycm/.ycm_extra_conf.py"
    endif

    " ç›´æ¥è§¦å‘è‡ªåŠ¨è¡¥å…¨ insertæ¨¡å¼ä¸‹
    " let g:ycm_key_invoke_completion = '<C-Space>'
    " é»‘åå•,ä¸å¯ç”¨
    let g:ycm_filetype_blacklist = {
        \ 'tagbar' : 1,
        \ 'gitcommit' : 1,
        \}
" }}}

" ################### å¿«é€Ÿç¼–ç  ###################

" nerdcommenter {{{
    let g:NERDSpaceDelims=1
" }}}

" delimitMate {{{
    " for python docstring ",ä¼˜åŒ–è¾“å…¥
    au FileType python let b:delimitMate_nesting_quotes = ['"']
    au FileType php let delimitMate_matchpairs = "(:),[:],{:}"
    " å…³é—­æŸäº›ç±»å‹æ–‡ä»¶çš„è‡ªåŠ¨è¡¥å…¨
    "au FileType mail let b:delimitMate_autoclose = 0
" }}}

" ################### åŠŸèƒ½ç›¸å…³ ###################

" ctrlp ctrlpfunky{{{
    "move
    " <C-j>: down
    " <C-K>: up
    let g:ctrlp_map = '<leader>jj'
    let g:ctrlp_cmd = 'CtrlP'
    nnoremap <leader>kk :CtrlPMRU<CR>
    let g:ctrlp_custom_ignore = {
        \ 'dir':  '\v[\/]\.(git|hg|svn|rvm)$',
        \ 'file': '\v\.(exe|so|dll|zip|tar|tar.gz|pyc)$',
        \ }
    let g:ctrlp_working_path_mode=0
    let g:ctrlp_match_window_bottom=1
    let g:ctrlp_max_height=15
    let g:ctrlp_match_window_reversed=0
    let g:ctrlp_mruf_max=500
    let g:ctrlp_follow_symlinks=1
    " å¦‚æœå®‰è£…äº†ag, ä½¿ç”¨ag
    " if executable('ag')
    " " Use ag in CtrlP for listing files. Lightning fast and respects .gitignore
    " let g:ctrlp_user_command = 'ag %s -l --nocolor -g ""'
    " " ag is fast enough that CtrlP doesn't need to cache
    " let g:ctrlp_use_caching = 0
    " endif

    " ctrlpfunky
    " ctrlpæ’ä»¶1 - ä¸ç”¨ctagè¿›è¡Œå‡½æ•°å¿«é€Ÿè·³è½¬
    nnoremap <Leader>ii :CtrlPFunky<Cr>
    " narrow the list down with a word under cursor
    "nnoremap <Leader>fU :execute 'CtrlPFunky ' . expand('<cword>')<Cr>
    let g:ctrlp_funky_syntax_highlight = 1

    let g:ctrlp_extensions = ['funky']
" }}}

" ################### å¿«é€Ÿå¯¼èˆª ###################

" nerdtree nerdtreetabs {{{
    nnoremap <leader>nn :NERDTreeToggle<CR>
    let NERDTreeHighlightCursorline=1
    let NERDTreeIgnore=[ '\.pyc$', '\.pyo$', '\.obj$', '\.o$', '\.so$', '\.egg$', '^\.git$', '^\.svn$', '^\.hg$' ]
    "close vim if the only window left open is a NERDTree
    autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTreeType") && b:NERDTreeType == "primary") | q | end
    " s/v åˆ†å±æ‰“å¼€æ–‡ä»¶
    let g:NERDTreeMapOpenSplit = 's'
    let g:NERDTreeMapOpenVSplit = 'v'


    " å…³é—­åŒæ­¥
    let g:nerdtree_tabs_synchronize_view=0
    let g:nerdtree_tabs_synchronize_focus=0
    " æ˜¯å¦è‡ªåŠ¨å¼€å¯nerdtree
    " thank to @ListenerRi, see https://github.com/wklken/k-vim/issues/165
    let g:nerdtree_tabs_open_on_console_startup=0
    let g:nerdtree_tabs_open_on_gui_startup=0
" }}}

" taglist {{{
    nnoremap <leader>aa :TlistToggle<CR>
    " let Tlist_Ctags_Cmd = '/usr/local/bin/ctags'
	let Tlist_GainFocus_On_ToggleOpen = 1
    let Tlist_Show_One_File = 1 "ä¸åŒæ—¶æ˜¾ç¤ºå¤šä¸ªæ–‡ä»¶çš„tagï¼Œåªæ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„
    " let Tlist_File_Fold_Auto_Close = 1
    let Tlist_Exit_OnlyWindow = 1 "å¦‚æœtaglistçª—å£æ˜¯æœ€åä¸€ä¸ªçª—å£ï¼Œåˆ™é€€å‡ºvim
" }}}

" æ ‡ç­¾å¯¼èˆª
" tagbar {{{
    nnoremap <leader>ff :TagbarToggle<CR>
    let g:tagbar_left = 1
    let g:tagbar_autofocus = 1
    " let g:tagbar_autoshowtag = 1
    " let g:tagbar_show_visibility = 1
    let g:tagbar_width=30
    let g:tagbar_sort = 0
    let g:tagbar_compact = 1

    " tag for coffee
    " if executable('coffeetags')
    " let g:tagbar_type_coffee = {
            " \ 'ctagsbin' : 'coffeetags',
            " \ 'ctagsargs' : '',
            " \ 'kinds' : [
            " \ 'f:functions',
            " \ 'o:object',
            " \ ],
            " \ 'sro' : ".",
            " \ 'kind2scope' : {
            " \ 'f' : 'object',
            " \ 'o' : 'object',
            " \ }
            " \ }

    " let g:tagbar_type_markdown = {
        " \ 'ctagstype' : 'markdown',
        " \ 'sort' : 0,
        " \ 'kinds' : [
            " \ 'h:sections'
        " \ ]
        " \ }
    " endif

    " for ruby
    let g:tagbar_type_ruby = {
        \ 'kinds' : [
            \ 'm:modules',
            \ 'c:classes',
            \ 'd:describes',
            \ 'C:contexts',
            \ 'f:methods',
            \ 'F:singleton methods'
        \ ]
    \ }

    let g:tagbar_type_cpp = {
        \ 'ctagstype' : 'c++',
        \ 'kinds'     : [
            \ 'd:macros:1:0',
            \ 'p:prototypes:1:0',
            \ 'g:enums',
            \ 'e:enumerators:0:0',
            \ 't:typedefs:0:0',
            \ 'n:namespaces',
            \ 'c:classes',
            \ 's:structs',
            \ 'u:unions',
            \ 'f:functions',
            \ 'm:members:0:0',
            \ 'v:variables:0:0'
        \ ],
        \ 'sro'        : '::',
        \ 'kind2scope' : {
            \ 'g' : 'enum',
            \ 'n' : 'namespace',
            \ 'c' : 'class',
            \ 's' : 'struct',
            \ 'u' : 'union'
        \ },
        \ 'scope2kind' : {
            \ 'enum'      : 'g',
            \ 'namespace' : 'n',
            \ 'class'     : 'c',
            \ 'struct'    : 's',
            \ 'union'     : 'u'
        \ }
    \ }

    " goè¯­è¨€çš„tagbaré…ç½®
    " 1. install gotags 'go get -u github.com/jstemmer/gotags'
    " 2. make sure `gotags` in you shell PATH, you can call check it with `which gotags`
    " for gotags. work with tagbar
    let g:tagbar_type_go = {
        \ 'ctagstype' : 'go',
        \ 'kinds'     : [
            \ 'p:package',
            \ 'i:imports:1',
            \ 'c:constants',
            \ 'v:variables',
            \ 't:types',
            \ 'n:interfaces',
            \ 'w:fields',
            \ 'e:embedded',
            \ 'm:methods',
            \ 'r:constructor',
            \ 'f:functions'
        \ ],
        \ 'sro' : '.',
        \ 'kind2scope' : {
            \ 't' : 'ctype',
            \ 'n' : 'ntype'
        \ },
        \ 'scope2kind' : {
            \ 'ctype' : 't',
            \ 'ntype' : 'n'
        \ },
        \ 'ctagsbin'  : 'gotags',
        \ 'ctagsargs' : '-sort -silent'
    \ }
" }}}

" syntastic {{{
    " dependence
    " 1. shellcheck `brew install shellcheck` https://github.com/koalaman/shellcheck

    let g:syntastic_error_symbol='>>'
    let g:syntastic_warning_symbol='>'
    let g:syntastic_check_on_open=1
    let g:syntastic_check_on_wq=0
    let g:syntastic_enable_highlighting=1

    " checkers
    " æœ€è½»é‡
    " let g:syntastic_python_checkers=['pyflakes'] " ä½¿ç”¨pyflakes
    " ä¸­ç­‰
    " error code: http://pep8.readthedocs.org/en/latest/intro.html#error-codes
    let g:syntastic_python_checkers=['pyflakes', 'pep8'] " ä½¿ç”¨pyflakes,é€Ÿåº¦æ¯”pylintå¿«
    let g:syntastic_python_pep8_args='--ignore=E501,E225,E124,E712'
    " é‡é‡çº§, ä½†æ˜¯è¶³å¤Ÿå¼ºå¤§, å®šåˆ¶å®Œæˆåç›¸å½“ä¸ªæ€§åŒ–
    " pylint codes: http://pylint-messages.wikidot.com/all-codes
    " let g:syntastic_python_checkers=['pyflakes', 'pylint'] " ä½¿ç”¨pyflakes,é€Ÿåº¦æ¯”pylintå¿«
    " let g:syntastic_python_checkers=['pylint'] " ä½¿ç”¨pyflakes,é€Ÿåº¦æ¯”pylintå¿«
    " let g:syntastic_python_pylint_args='--disable=C0111,R0903,C0301'

    " if js
    " let g:syntastic_javascript_checkers = ['jsl', 'jshint']
    " let g:syntastic_html_checkers=['tidy', 'jshint']

    " to see error location list
    let g:syntastic_always_populate_loc_list = 1
    let g:syntastic_enable_signs = 1
    let g:syntastic_auto_loc_list = 0
    let g:syntastic_auto_jump = 0
    let g:syntastic_loc_list_height = 5

    function! ToggleErrors()
        let old_last_winnr = winnr('$')
        lclose
        if old_last_winnr == winnr('$')
            " Nothing was closed, open syntastic_error location panel
            Errors
        endif
    endfunction
    nnoremap <Leader>s :call ToggleErrors()<cr>

    " ,en ,ep to jump between errors
    function! <SID>LocationPrevious()
    try
        lprev
    catch /^Vim\%((\a\+)\)\=:E553/
        llast
    endtry
    endfunction

    function! <SID>LocationNext()
    try
        lnext
    catch /^Vim\%((\a\+)\)\=:E553/
        lfirst
    endtry
    endfunction

    nnoremap <silent> <Plug>LocationPrevious    :<C-u>exe 'call <SID>LocationPrevious()'<CR>
    nnoremap <silent> <Plug>LocationNext        :<C-u>exe 'call <SID>LocationNext()'<CR>
    nnoremap <silent> <Leader>ep    <Plug>LocationPrevious
    nnoremap <silent> <Leader>en    <Plug>LocationNext

    " ä¿®æ”¹é«˜äº®çš„èƒŒæ™¯è‰², é€‚åº”ä¸»é¢˜
    highlight SyntasticErrorSign guifg=white guibg=black

    " ç¦æ­¢æ’ä»¶æ£€æŸ¥java
    " thanks to @marsqing, see https://github.com/wklken/k-vim/issues/164
    let g:syntastic_mode_map = {'mode': 'active', 'passive_filetypes': ['java'] }
" }}}

" multiplecursors {{{
    let g:multi_cursor_use_default_mapping=0
    " Default mapping
    let g:multi_cursor_next_key='<C-m>'
    let g:multi_cursor_prev_key='<C-p>'
    let g:multi_cursor_skip_key='<C-x>'
    let g:multi_cursor_quit_key='<Esc>'
" }}}

" git.  gitæ“ä½œè¿˜æ˜¯ä¹ æƒ¯å‘½ä»¤è¡Œ,vimé‡Œé¢å¤„ç†ç®€å•diffç¼–è¾‘æ“ä½œ

" fugitive {{{
    " :Gdiff  :Gstatus :Gvsplit
    nnoremap <leader>ge :Gdiff<CR>
    " not ready to open
    " <leader>gb maps to :Gblame<CR>
    " <leader>gs maps to :Gstatus<CR>
    " <leader>gd maps to :Gdiff<CR>  å’Œç°æœ‰å†²çª
    " <leader>gl maps to :Glog<CR>
    " <leader>gc maps to :Gcommit<CR>
    " <leader>gp maps to :Git push<CR>
" }}}

" gitgutter {{{
    " åŒgit diff,å®æ—¶å±•ç¤ºæ–‡ä»¶ä¸­ä¿®æ”¹çš„è¡Œ
    " åªæ˜¯ä¸å–œæ¬¢é™¤äº†è¡Œå·å¤šä¸€åˆ—, é»˜è®¤å…³é—­,ggæ—¶æ‰“å¼€
    let g:gitgutter_map_keys = 0
    let g:gitgutter_enabled = 0
    let g:gitgutter_highlight_lines = 1
    nnoremap <leader>gg :GitGutterToggle<CR>
" }}}

" gundo {{{
    nnoremap <leader>hh :GundoToggle<CR>
" }}}

" ################### æ˜¾ç¤ºå¢å¼º ###################

" airline {{{
    " æ˜¯å¦æ‰“å¼€tabline
    let g:airline#extensions#tabline#enabled = 0
    let g:airline#extensions#whitespace#enabled = 0

    if !exists('g:airline_symbols')
        let g:airline_symbols = {}
    endif

    let g:airline_left_sep = 'Â»'
    let g:airline_right_sep = 'Â«'
    let g:airline_symbols.maxlinenr = ''

    if !exists('g:airline_theme')
        if has('gui_running')
            let g:airline_theme = 'solarized'
        else
            let g:airline_theme = 'molokai'
        endif
    endif

    " unicode symbols
    " let g:airline_left_sep = 'Â»'
    " let g:airline_left_sep = 'â–¶'
    " let g:airline_right_sep = 'Â«'
    " let g:airline_right_sep = 'â—€'
    " let g:airline_symbols.crypt = 'ğŸ”’'
    " let g:airline_symbols.linenr = 'âŠ'
    " let g:airline_symbols.linenr = 'â¤'
    " let g:airline_symbols.linenr = 'Â¶'
    " let g:airline_symbols.maxlinenr = 'â˜°'
    " let g:airline_symbols.maxlinenr = ''
    " let g:airline_symbols.branch = 'â‡'
    " let g:airline_symbols.paste = 'Ï'
    " let g:airline_symbols.paste = 'Ã'
    " let g:airline_symbols.paste = 'âˆ¥'
    " let g:airline_symbols.spell = 'ê¨'
    " let g:airline_symbols.notexists = 'âˆ„'
    " let g:airline_symbols.whitespace = 'Î'
" }}}

" trailingwhitespace {{{
    nnoremap <leader><space> :FixWhitespace<cr>
" }}}

" ################### å¿«é€Ÿé€‰ä¸­ ###################

" expandregion {{{
    " map + <Plug>(expand_region_expand)
    " map _ <Plug>(expand_region_shrink)
    vmap v <Plug>(expand_region_expand)
    vmap V <Plug>(expand_region_shrink)
" }}}

" ################### å¿«é€Ÿç§»åŠ¨ ###################

" easymotion {{{
    let g:EasyMotion_smartcase = 1
    "let g:EasyMotion_startofline = 0 " keep cursor colum when JK motion
    nmap <Leader><leader>h <Plug>(easymotion-linebackward)
    nmap <Leader><Leader>j <Plug>(easymotion-j)
    nmap <Leader><Leader>k <Plug>(easymotion-k)
    nmap <Leader><leader>l <Plug>(easymotion-lineforward)
    " é‡å¤ä¸Šä¸€æ¬¡æ“ä½œ, ç±»ä¼¼repeatæ’ä»¶, å¾ˆå¼ºå¤§
    nnoremap <Leader><leader>. <Plug>(easymotion-repeat)
" }}}


" quickscope {{{
    let g:qs_highlight_on_keys = ['f', 'F', 't', 'T']
    " macvim/gvimä¼šæœ‰é—®é¢˜, æš‚æ—¶æ³¨è§£
    " let g:qs_first_occurrence_highlight_color = '#afff5f' " gui vim
    " let g:qs_first_occurrence_highlight_color = 155       " terminal vim
    " let g:qs_second_occurrence_highlight_color = '#5fffff'  " gui vim
    " let g:qs_second_occurrence_highlight_color = 81         " terminal vim
" }}}

" closetag {{{
    let g:closetag_html_style=1
" }}}

if g:islinux
" neocomplete {
    let g:acp_enableAtStartup = 0
    let g:neocomplete#enable_at_startup = 1
    let g:neocomplete#enable_smart_case = 1
    let g:neocomplete#enable_auto_delimiter = 1
    let g:neocomplete#max_list = 15
    let g:neocomplete#force_overwrite_completefunc = 1


    " Define dictionary.
    let g:neocomplete#sources#dictionary#dictionaries = {
                \ 'default' : '',
                \ 'vimshell' : $HOME.'/.vimshell_hist',
                \ 'scheme' : $HOME.'/.gosh_completions'
                \ }

    " Define keyword.
    if !exists('g:neocomplete#keyword_patterns')
        let g:neocomplete#keyword_patterns = {}
    endif
    let g:neocomplete#keyword_patterns['default'] = '\h\w*'

    " Plugin key-mappings {
        " These two lines conflict with the default digraph mapping of <C-K>
        if !exists('g:spf13_no_neosnippet_expand')
            imap <C-k> <Plug>(neosnippet_expand_or_jump)
            smap <C-k> <Plug>(neosnippet_expand_or_jump)
        endif
        if exists('g:spf13_noninvasive_completion')
            inoremap <CR> <CR>
            " <ESC> takes you out of insert mode
            inoremap <expr> <Esc>   pumvisible() ? "\<C-y>\<Esc>" : "\<Esc>"
            " <CR> accepts first, then sends the <CR>
            inoremap <expr> <CR>    pumvisible() ? "\<C-y>\<CR>" : "\<CR>"
            " <Down> and <Up> cycle like <Tab> and <S-Tab>
            inoremap <expr> <Down>  pumvisible() ? "\<C-n>" : "\<Down>"
            inoremap <expr> <Up>    pumvisible() ? "\<C-p>" : "\<Up>"
            " Jump up and down the list
            inoremap <expr> <C-d>   pumvisible() ? "\<PageDown>\<C-p>\<C-n>" : "\<C-d>"
            inoremap <expr> <C-u>   pumvisible() ? "\<PageUp>\<C-p>\<C-n>" : "\<C-u>"
        else
            " <C-k> Complete Snippet
            " <C-k> Jump to next snippet point
            imap <silent><expr><C-k> neosnippet#expandable() ?
                        \ "\<Plug>(neosnippet_expand_or_jump)" : (pumvisible() ?
                        \ "\<C-e>" : "\<Plug>(neosnippet_expand_or_jump)")
            smap <TAB> <Right><Plug>(neosnippet_jump_or_expand)

            inoremap <expr><C-g> neocomplete#undo_completion()
            inoremap <expr><C-l> neocomplete#complete_common_string()
            "inoremap <expr><CR> neocomplete#complete_common_string()

            " <CR>: close popup
            " <s-CR>: close popup and save indent.
            inoremap <expr><s-CR> pumvisible() ? neocomplete#smart_close_popup()."\<CR>" : "\<CR>"

            " <C-h>, <BS>: close popup and delete backword char.
            inoremap <expr><BS> neocomplete#smart_close_popup()."\<C-h>"
            inoremap <expr><C-y> neocomplete#smart_close_popup()
        endif
        " <TAB>: completion.
        inoremap <expr><TAB> pumvisible() ? "\<C-n>" : "\<TAB>"
        inoremap <expr><S-TAB> pumvisible() ? "\<C-p>" : "\<TAB>"

        " Courtesy of Matteo Cavalleri

        function! CleverTab()
            if pumvisible()
                return "\<C-n>"
            endif
            let substr = strpart(getline('.'), 0, col('.') - 1)
            let substr = matchstr(substr, '[^ \t]*$')
            if strlen(substr) == 0
                " nothing to match on empty string
                return "\<Tab>"
            else
                " existing text matching
                if neosnippet#expandable_or_jumpable()
                    return "\<Plug>(neosnippet_expand_or_jump)"
                else
                    return neocomplete#start_manual_complete()
                endif
            endif
        endfunction

        imap <expr> <Tab> CleverTab()
    " }

    " Enable heavy omni completion.
    if !exists('g:neocomplete#sources#omni#input_patterns')
        let g:neocomplete#sources#omni#input_patterns = {}
    endif
    let g:neocomplete#sources#omni#input_patterns.php = '[^. \t]->\h\w*\|\h\w*::'
    let g:neocomplete#sources#omni#input_patterns.perl = '\h\w*->\h\w*\|\h\w*::'
    let g:neocomplete#sources#omni#input_patterns.c = '[^.[:digit:] *\t]\%(\.\|->\)'
    let g:neocomplete#sources#omni#input_patterns.cpp = '[^.[:digit:] *\t]\%(\.\|->\)\|\h\w*::'
    let g:neocomplete#sources#omni#input_patterns.ruby = '[^. *\t]\.\h\w*\|\h\w*::'
" }

" SuperTab
" let g:SuperTabDefultCompletionType='context'
"let g:SuperTabDefaultCompletionType = '<C-X><C-U>'
 let g:SuperTabRetainCompletionType=2
endif

" è®¾ç½®vundleå‚æ•°
filetype off                  " å¿…é¡»

if g:islinux
    set rtp+=~/.vim/bundle/Vundle.vim
    call vundle#begin()
else
    set rtp+=$VIM/vimfiles/bundle/vundle/
    call vundle#rc('$VIM/vimfiles/bundle/')
endif

" è®©vundleç®¡ç†æ’ä»¶ç‰ˆæœ¬,å¿…é¡»
Plugin 'VundleVim/Vundle.vim'
Bundle 'taglist.vim'
" tagbar
Bundle 'majutsushi/tagbar'
" nerdtree nerdtreetabs
Bundle 'scrooloose/nerdtree'
"Bundle 'jistr/vim-nerdtree-tabs'
" ä¸»é¢˜ solarized
" solarized
Bundle 'altercation/vim-colors-solarized'
" molokai
" ä¸»é¢˜ molokai
Bundle 'tomasr/molokai'
" quick locate file or function
" æ–‡ä»¶æœç´¢
" change to https://github.com/ctrlpvim/ctrlp.vim
" ctrlp ctrlpfunky
Bundle 'ctrlpvim/ctrlp.vim'
Bundle 'tacahiroy/ctrlp-funky'
" quick edit
" å¿«é€Ÿæ³¨é‡Š
Bundle 'scrooloose/nerdcommenter'
" å¤šå…‰æ ‡é€‰ä¸­ç¼–è¾‘
" multiplecursors
Bundle 'terryma/vim-multiple-cursors'
" view
" airline
" çŠ¶æ€æ å¢å¼ºå±•ç¤º
Bundle 'vim-airline/vim-airline'
Bundle 'vim-airline/vim-airline-themes'

" trailingwhitespace
" å¿«é€Ÿå»è¡Œå°¾ç©ºæ ¼ [, + <Space>]
Bundle 'bronson/vim-trailing-whitespace'

" quick movement
" easymotion
"æ›´é«˜æ•ˆçš„ç§»åŠ¨ [,, + w/fx/h/j/k/l]
Bundle 'Lokaltog/vim-easymotion'
"Bundle 'vim-scripts/matchit.zip'

" æ›´é«˜æ•ˆçš„è¡Œå†…ç§»åŠ¨, f/F/t/T, æ‰è§¦å‘
" quickscope
Bundle 'unblevable/quick-scope'
" è‡ªåŠ¨è¡¥å…¨å•å¼•å·ï¼ŒåŒå¼•å·ç­‰
"Bundle 'Raimondi/delimitMate'
" è‡ªåŠ¨è¡¥å…¨html/xmlæ ‡ç­¾
"Bundle 'docunext/closetag.vim'
" rainbow_parentheses
" æ‹¬å·æ˜¾ç¤ºå¢å¼º
" Bundle 'kien/rainbow_parentheses.vim'

" quick selection and edit
" expandregion
" é€‰ä¸­åŒºå—
Bundle 'terryma/vim-expand-region'

if g:islinux
" git
" fugitive
Bundle 'tpope/vim-fugitive'
" gitgutter
Bundle 'airblade/vim-gitgutter'

" gundo
" edit history, å¯ä»¥æŸ¥çœ‹å›åˆ°æŸä¸ªå†å²çŠ¶æ€
Bundle 'sjl/gundo.vim'

" syntastic
"Bundle 'scrooloose/syntastic'

Bundle 'Shougo/neocomplete'
Bundle 'ervandew/supertab'

" vimshell
Bundle 'Shougo/vimshell'
Bundle 'Shougo/vimproc.vim'

" auto complete
" ä»£ç è‡ªåŠ¨è¡¥å…¨
" è¿„ä»Šä¸ºæ­¢ç”¨åˆ°çš„æœ€å¥½çš„è‡ªåŠ¨VIMè‡ªåŠ¨è¡¥å…¨æ’ä»¶
" é‡å¯ :YcmRestartServer
"python install.py --clang-completer"
"git submodule update --init --recursive
"Bundle 'Valloric/YouCompleteMe'
endif


if g:islinux
call vundle#end()            " å¿…é¡»
endif
filetype plugin indent on    " å¿…é¡» åŠ è½½vimè‡ªå¸¦å’Œæ’ä»¶ç›¸åº”çš„è¯­æ³•å’Œæ–‡ä»¶ç±»å‹ç›¸å…³è„šæœ¬
" å¿½è§†æ’ä»¶æ”¹å˜ç¼©è¿›,å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ›¿ä»£:
"filetype plugin on
"
" ç®€è¦å¸®åŠ©æ–‡æ¡£
" :PluginList       - åˆ—å‡ºæ‰€æœ‰å·²é…ç½®çš„æ’ä»¶
" :PluginInstall    - å®‰è£…æ’ä»¶,è¿½åŠ  `!` ç”¨ä»¥æ›´æ–°æˆ–ä½¿ç”¨ :PluginUpdate
" :PluginSearch foo - æœç´¢ foo ; è¿½åŠ  `!` æ¸…é™¤æœ¬åœ°ç¼“å­˜
" :PluginClean      - æ¸…é™¤æœªä½¿ç”¨æ’ä»¶,éœ€è¦ç¡®è®¤; è¿½åŠ  `!` è‡ªåŠ¨æ‰¹å‡†ç§»é™¤æœªä½¿ç”¨æ’ä»¶
"
" æŸ¥é˜… :h vundle è·å–æ›´å¤šç»†èŠ‚å’Œwikiä»¥åŠFAQ
" å°†ä½ è‡ªå·±å¯¹éæ’ä»¶ç‰‡æ®µæ”¾åœ¨è¿™è¡Œä¹‹å


if g:iswindows
"è§£å†³èœå•ä¹±ç 
source $VIMRUNTIME/delmenu.vim
source $VIMRUNTIME/menu.vim
"è§£å†³consoleè¾“å‡ºä¹±ç 
language message zh_CN.utf-8
endif

